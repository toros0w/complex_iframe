<template>
  <div class="compass">
    <div
      class="compassImage"
      ref="wrapper"
      :style="`transform: rotate(${props.formData.light_angle}deg)`"
      @mouseleave="drag = false"
      @mousemove="mousemoveHandler($event)"
    >
      <svg
        width="300"
        height="300"
        viewBox="0 0 300 300"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M150 299C232.29 299 299 232.29 299 150C299 67.7096 232.29 1 150 1C67.7096 1 1 67.7096 1 150C1 232.29 67.7096 299 150 299Z"
          stroke="#9E9E9E"
          stroke-width="2"
          stroke-dasharray="8 8"
        />
        <path
          d="M150 225C191.421 225 225 191.421 225 150C225 108.579 191.421 75 150 75"
          stroke="#9E9E9E"
          stroke-width="2"
        />
        <path
          d="M150 225C108.579 225 75 191.421 75 150C75 108.579 108.579 75 150 75"
          stroke="#F2B720"
          stroke-width="2"
          stroke-dasharray="10 10"
        />
        <path
          d="M166 75.5003L149.5 85.4596V65.541L166 75.5003Z"
          fill="#F2B720"
        />
        <path
          d="M150 230C152.761 230 155 227.761 155 225C155 222.239 152.761 220 150 220C147.239 220 145 222.239 145 225C145 227.761 147.239 230 150 230Z"
          fill="#F2B720"
        />
        <path
          d="M143 144.038L146.24 153.76L155.962 157L175 125L143 144.038Z"
          fill="#909090"
        />
        <path d="M124 176L156 156.962L143.038 144L124 176Z" fill="#FF3838" />
        <path
          d="M87.3698 143.874L82.693 145.682C82.6285 145.706 82.5704 145.74 82.5131 145.773C81.7921 144.491 80.7754 143.449 79.5817 142.702C79.6184 142.645 79.6543 142.586 79.6821 142.524L81.7109 137.939C81.8464 137.631 81.8546 137.291 81.7337 136.978C81.6129 136.666 81.378 136.419 81.0709 136.283C80.7643 136.148 80.4226 136.139 80.1105 136.26C79.7983 136.38 79.5513 136.616 79.4159 136.923L77.3871 141.508C77.3584 141.571 77.3392 141.636 77.3225 141.702C75.9663 141.321 74.5116 141.268 73.0769 141.598C73.0633 141.533 73.0479 141.468 73.0232 141.404L71.2156 136.727C70.9661 136.082 70.2386 135.76 69.5934 136.009C68.9479 136.258 68.6257 136.986 68.8753 137.632L70.6829 142.309C70.7078 142.373 70.7411 142.431 70.7743 142.488C69.4909 143.21 68.4506 144.226 67.7025 145.42C67.6463 145.384 67.588 145.348 67.5245 145.32L62.94 143.291C62.6329 143.156 62.2922 143.147 61.9795 143.268C61.6668 143.388 61.4203 143.624 61.2844 143.931C61.1493 144.238 61.1402 144.579 61.2611 144.891C61.382 145.204 61.6178 145.45 61.9243 145.586L66.5095 147.615C66.5727 147.643 66.6375 147.662 66.7038 147.68C66.3227 149.035 66.2708 150.49 66.5999 151.924C66.5344 151.938 66.4691 151.952 66.4051 151.977L61.7284 153.785C61.0828 154.034 60.7607 154.762 61.0102 155.408C61.2597 156.053 61.9877 156.375 62.6333 156.126L67.31 154.318C67.3745 154.293 67.433 154.261 67.4904 154.227C68.2114 155.51 69.2277 156.551 70.4223 157.298C70.3857 157.355 70.3497 157.413 70.3215 157.476L68.2932 162.061C68.1577 162.368 68.1495 162.709 68.2704 163.021C68.3912 163.334 68.6261 163.58 68.9332 163.717C69.2398 163.852 69.5809 163.861 69.8936 163.74C70.2058 163.619 70.4528 163.383 70.5882 163.077L72.617 158.492C72.6457 158.429 72.6649 158.363 72.6816 158.297C74.0368 158.678 75.4912 158.731 76.9263 158.402C76.9399 158.467 76.9543 158.532 76.979 158.596L78.7866 163.273C79.0362 163.918 79.7642 164.241 80.4097 163.991C81.0549 163.742 81.3765 163.014 81.127 162.368L79.3193 157.692C79.2944 157.627 79.2616 157.569 79.2289 157.512C80.5117 156.791 81.5525 155.774 82.3002 154.58C82.3572 154.617 82.4155 154.652 82.4786 154.68L87.0632 156.709C87.3704 156.844 87.711 156.853 88.0237 156.732C88.3364 156.611 88.5829 156.375 88.7189 156.069C88.854 155.762 88.863 155.421 88.7422 155.109C88.6213 154.796 88.3855 154.55 88.0789 154.413L83.4941 152.386C83.4306 152.357 83.3653 152.338 83.2998 152.321C83.6805 150.965 83.7328 149.511 83.4037 148.077C83.4691 148.063 83.5341 148.047 83.5982 148.023L88.2749 146.215C88.9205 145.966 89.2426 145.238 88.9931 144.592C88.7432 143.947 88.0153 143.624 87.3698 143.874ZM80.4705 147.886C81.636 150.902 80.1307 154.303 77.1153 155.468C74.0999 156.634 70.6986 155.129 69.5331 152.114C68.3676 149.098 69.8728 145.697 72.8882 144.532C75.9036 143.366 79.305 144.871 80.4705 147.886Z"
          fill="#F2B720"
        />
        <path
          d="M80.4705 147.886C81.636 150.902 80.1307 154.303 77.1153 155.468C74.0999 156.634 70.6986 155.129 69.5331 152.114C68.3676 149.098 69.8728 145.697 72.8882 144.532C75.9036 143.366 79.305 144.871 80.4705 147.886Z"
          fill="white"
        />
        <path
          d="M155.466 41.0002H153.705C153.6 40.4936 153.418 40.0485 153.158 39.665C152.902 39.2814 152.589 38.9595 152.22 38.6991C151.856 38.4339 151.451 38.235 151.006 38.1025C150.561 37.9699 150.097 37.9036 149.614 37.9036C148.733 37.9036 147.935 38.1261 147.22 38.5712C146.51 39.0163 145.944 39.6721 145.523 40.5386C145.106 41.405 144.898 42.468 144.898 43.7275C144.898 44.9869 145.106 46.0499 145.523 46.9164C145.944 47.7829 146.51 48.4386 147.22 48.8837C147.935 49.3288 148.733 49.5513 149.614 49.5513C150.097 49.5513 150.561 49.485 151.006 49.3525C151.451 49.2199 151.856 49.0234 152.22 48.763C152.589 48.4978 152.902 48.1735 153.158 47.79C153.418 47.4017 153.6 46.9566 153.705 46.4547H155.466C155.333 47.1981 155.092 47.8634 154.741 48.4505C154.391 49.0376 153.955 49.5371 153.435 49.9491C152.914 50.3563 152.329 50.6664 151.68 50.8795C151.036 51.0925 150.348 51.1991 149.614 51.1991C148.373 51.1991 147.27 50.896 146.304 50.29C145.338 49.6839 144.578 48.8222 144.024 47.7047C143.47 46.5873 143.193 45.2616 143.193 43.7275C143.193 42.1934 143.47 40.8676 144.024 39.7502C144.578 38.6328 145.338 37.771 146.304 37.165C147.27 36.5589 148.373 36.2559 149.614 36.2559C150.348 36.2559 151.036 36.3624 151.68 36.5755C152.329 36.7886 152.914 37.1011 153.435 37.513C153.955 37.9202 154.391 38.4173 154.741 39.0045C155.092 39.5868 155.333 40.2521 155.466 41.0002Z"
          fill="#9E9E9E"
        />
        <path
          d="M145.524 244.455V259H143.762V244.455H145.524ZM148.698 251.074V252.636H144.245V251.074H148.698ZM161.035 251.727C161.035 253.261 160.758 254.587 160.204 255.705C159.65 256.822 158.89 257.684 157.924 258.29C156.958 258.896 155.855 259.199 154.615 259.199C153.374 259.199 152.271 258.896 151.305 258.29C150.339 257.684 149.579 256.822 149.025 255.705C148.471 254.587 148.194 253.261 148.194 251.727C148.194 250.193 148.471 248.867 149.025 247.75C149.579 246.633 150.339 245.771 151.305 245.165C152.271 244.559 153.374 244.256 154.615 244.256C155.855 244.256 156.958 244.559 157.924 245.165C158.89 245.771 159.65 246.633 160.204 247.75C160.758 248.867 161.035 250.193 161.035 251.727ZM159.331 251.727C159.331 250.468 159.12 249.405 158.698 248.538C158.282 247.672 157.716 247.016 157.001 246.571C156.291 246.126 155.495 245.903 154.615 245.903C153.734 245.903 152.936 246.126 152.221 246.571C151.511 247.016 150.945 247.672 150.524 248.538C150.107 249.405 149.899 250.468 149.899 251.727C149.899 252.987 150.107 254.05 150.524 254.916C150.945 255.783 151.511 256.438 152.221 256.884C152.936 257.329 153.734 257.551 154.615 257.551C155.495 257.551 156.291 257.329 157.001 256.884C157.716 256.438 158.282 255.783 158.698 254.916C159.12 254.05 159.331 252.987 159.331 251.727Z"
          fill="#9E9E9E"
        />
        <path
          d="M236.762 157V142.455H241.848C242.861 142.455 243.697 142.63 244.355 142.98C245.013 143.326 245.503 143.792 245.825 144.379C246.147 144.962 246.308 145.608 246.308 146.318C246.308 146.943 246.197 147.459 245.974 147.866C245.756 148.274 245.467 148.596 245.108 148.832C244.752 149.069 244.367 149.244 243.95 149.358V149.5C244.395 149.528 244.842 149.685 245.292 149.969C245.742 150.253 246.118 150.66 246.421 151.19C246.724 151.721 246.876 152.369 246.876 153.136C246.876 153.866 246.71 154.521 246.379 155.104C246.047 155.686 245.524 156.148 244.809 156.489C244.094 156.83 243.164 157 242.018 157H236.762ZM238.524 155.438H242.018C243.169 155.438 243.985 155.215 244.468 154.77C244.956 154.32 245.2 153.776 245.2 153.136C245.2 152.644 245.074 152.189 244.823 151.773C244.572 151.351 244.215 151.015 243.751 150.764C243.287 150.509 242.738 150.381 242.103 150.381H238.524V155.438ZM238.524 148.847H241.791C242.321 148.847 242.799 148.742 243.225 148.534C243.656 148.326 243.997 148.032 244.248 147.653C244.504 147.275 244.632 146.83 244.632 146.318C244.632 145.679 244.409 145.137 243.964 144.692C243.519 144.242 242.814 144.017 241.848 144.017H238.524V148.847Z"
          fill="#9E9E9E"
        />
        <path
          d="M38.4198 157.199C37.4823 157.199 36.6466 157.038 35.9127 156.716C35.1835 156.394 34.6035 155.946 34.1726 155.374C33.7465 154.796 33.5145 154.126 33.4766 153.364H35.2663C35.3042 153.832 35.4652 154.237 35.7493 154.578C36.0334 154.914 36.4051 155.175 36.8644 155.359C37.3236 155.544 37.8326 155.636 38.3913 155.636C39.0163 155.636 39.5703 155.527 40.0533 155.31C40.5362 155.092 40.915 154.789 41.1896 154.401C41.4643 154.012 41.6016 153.562 41.6016 153.051C41.6016 152.516 41.469 152.045 41.2038 151.638C40.9387 151.226 40.5504 150.904 40.0391 150.672C39.5277 150.44 38.9027 150.324 38.1641 150.324H36.9993V148.761H38.1641C38.7417 148.761 39.2484 148.657 39.684 148.449C40.1243 148.241 40.4676 147.947 40.7138 147.568C40.9647 147.189 41.0902 146.744 41.0902 146.233C41.0902 145.741 40.9813 145.312 40.7635 144.947C40.5457 144.583 40.2379 144.299 39.8402 144.095C39.4472 143.892 38.9832 143.79 38.4482 143.79C37.9463 143.79 37.4728 143.882 37.0277 144.067C36.5874 144.247 36.2275 144.509 35.9482 144.855C35.6688 145.196 35.5173 145.608 35.4936 146.091H33.7891C33.8175 145.329 34.0471 144.661 34.478 144.088C34.9089 143.51 35.4723 143.061 36.1683 142.739C36.8691 142.417 37.6385 142.256 38.4766 142.256C39.3762 142.256 40.148 142.438 40.7919 142.803C41.4359 143.162 41.9306 143.638 42.2763 144.23C42.6219 144.822 42.7948 145.461 42.7948 146.148C42.7948 146.967 42.5793 147.665 42.1484 148.243C41.7223 148.821 41.1423 149.221 40.4084 149.443V149.557C41.327 149.708 42.0443 150.099 42.5604 150.729C43.0765 151.354 43.3345 152.128 43.3345 153.051C43.3345 153.842 43.1191 154.552 42.6882 155.182C42.2621 155.807 41.6797 156.299 40.9411 156.659C40.2024 157.019 39.362 157.199 38.4198 157.199Z"
          fill="#9E9E9E"
        />
      </svg>
      <div
        class="point"
        ref="point"
        @mousedown="mouseDownHandler()"
        @mouseup="drag = false"
      ></div>
    </div>
    <InputText v-model="props.formData.light_angle" @update:modelValue="changedFromInput"/>
  </div>
</template>

<script setup>
import { ref, watch } from "vue";

const props = defineProps({
  formData: Object
})
const point = ref(HTMLElement);
const wrapper = ref(HTMLElement);
const drag = ref(false);
// const degrees = ref("0");
let coordPoint = null;
let x1 = 0;
let y1 = 0;

const emits = defineEmits(
  ["update:degrees"]
);

const mouseDownHandler = () => {
  if (wrapper.value && point.value) {
    drag.value = true;
    coordPoint = wrapper.value.getBoundingClientRect();
    x1 = coordPoint.left + coordPoint.width / 2;
    y1 = coordPoint.top + coordPoint.height / 2;
  }
};

const changedFromInput = (newVal) => {
  wrapper.value.style.transform = "rotate(" + newVal + "deg)";
}

const mousemoveHandler = (e) => {
  if (wrapper.value && point.value && drag.value) {
    let angle = Math.atan2(e.y - y1, e.x - x1);
    let degreesEd = angle * 57.3;

    if (angle < 0) {
      degreesEd = 360 + degreesEd;
    }

    wrapper.value.style.transform = "rotate(" + degreesEd + "deg)";
    props.formData.light_angle = String(Math.floor(degreesEd));
  }
};

watch(props.formData.light_angle, (newV) => {
  if (wrapper.value) {
    
    wrapper.value.style.transform = "rotate(" + newV + "deg)";
  }
});
</script>

<style scoped lang="scss">
.compass {
  width: 100%;
  height: auto;
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  row-gap: 20px;

  .compassImage {
    position: relative;
    width: 200px;
    height: 200px;
    svg {
      width: 100%;
      height: 100%;
    }
    .point {
      position: absolute;
      top: calc(50% - 12.5px);
      right: -12.5px;
      width: 25px;
      height: 25px;
      border-radius: 100%;
      background-color: #3a8efa;
    }
  }
}
</style>
